# Moto-Drag TODO

Keep this file synchronized with ongoing work. Update every time a task changes status or new scope is added.

## Active Checklist

- [x] Описаны актуальные пользовательские истории и критерии (см. `docs/user_stories_ru.md`).
- [x] Реализовать мастер первой настройки (админ, название трассы, синхронизация времени, калибровка одного/двух лучей) — UI scaffolding готово в `web/`, связать с реальными API.
  - [x] Dev сервер: хранить `epoch` + `millis`, отдавать живое состояние и отображать его в админке.
  - [x] Реальный модуль: добавить те же поля в прошивке, завернуть API и убедиться, что UI читает данные из живой прошивки.
  - [x] Сохранять админ-профиль/калибровку/часы в SPIFFS бинарным форматом (ArduinoJson MessagePack или аналог) и поднимать состояние при ребуте.
- [ ] Добавить повторный доступ к калибровке и переключению режима лучей в админ-интерфейсе.
  - [x] Калибровка: за 3–5 с собирать min/max/avg по фотосенсору, сохранять baseline + delta и отдавать их через API.
  - [ ] Показать в UI текущие ambient/threshold и статус луча (OK/blocked) для диагностики на трассе.
- [ ] Реализовать веб-форму гонки (`moto.local`) с вводом имени и кнопками «Готов»/«Сброс», тянущую режим и круги из админки.
  - [x] Настроить mDNS/Bonjour, чтобы `moto.local` указывал на ESP32 AP без внешнего DNS.
  - [ ] SPA-страница гонки: поле имени (сохранение в localStorage), отображение текущего режима/кругов, кнопки старта/сброса и живой таймер.
- [ ] Настроить обработку лазерных датчиков: старт по первому импульсу, игнорирование заднего колеса, поддержка двух лучей.
  - [ ] Связать события break/restore с таймером круга (старт, финиш, сброс).
- [ ] Обновлять LED-панель: отображать `00:00.000` до старта, обновлять таймер каждые 100 мс, показывать результат бегущей строкой, поддержать кнопку сброса.
- [ ] Создать страницу лидербордов («Топы») в SPA с офлайн-данными и фильтрами по трассам/пилотам.
- [ ] Хранить заезды в SPIFFS как дневные бинарные журналы (MessagePack/CBOR) с короткими ключами и идентификаторами пилотов/трасс, реализовать справочники, разделы «Мои заезды»/«Топы» и выгрузку архива.
- [ ] Перенести HUB75-панель на ESP32 или ESP32-S3. Текущая ESP32-C3 сборка работает без матрицы (ждём подходящую плату, библиотека `ESP32-HUB75-MatrixPanel-I2S-DMA` не поддерживает C3/I2S DMA).
